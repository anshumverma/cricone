<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CricOne - Cricket Academy Membership Manager</title>
    <meta name="description" content="Browser-based membership tracking for cricket academies">
    <link rel="icon" type="image/png" href="assets/images/cricone-logo.png">
    <link rel="stylesheet" href="src/styles.css">
    <!-- SheetJS library for Excel parsing -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <!-- date-fns library for date manipulation -->
    <script src="https://cdn.jsdelivr.net/npm/date-fns@3.0.0/index.min.js"></script>
</head>
<body>
    <div class="container">
        <header role="banner">
            <div class="header-brand">
                <img src="assets/images/cricone-logo.png" alt="CricOne Logo" class="logo">
                <h1>CricOne</h1>
            </div>
            
            <!-- Campaigns Dropdown (like Gmail search bar) -->
            <div class="search-bar-container">
                <select id="campaignFilter" class="search-bar-select" aria-label="Filter by membership campaign">
                    <option value="all">All Campaigns</option>
                </select>
            </div>
            
            <div class="header-actions">
                <button 
                    id="themeToggleBtn" 
                    class="icon-btn" 
                    aria-label="Toggle theme"
                    title="Switch between light and dark theme">
                    <span aria-hidden="true">â˜€ï¸</span>
                </button>
                <button 
                    id="notificationsBtn" 
                    class="icon-btn" 
                    aria-label="View notifications"
                    title="View import notifications">
                    <span aria-hidden="true">ğŸ””</span>
                    <span id="notificationBadge" class="notification-badge" style="display: none;">0</span>
                </button>
                <button 
                    id="exportBtn" 
                    class="icon-btn" 
                    disabled
                    aria-label="Export filtered data to Excel"
                    title="Export the current view to an Excel file">
                    <span aria-hidden="true">â¬‡</span>
                </button>
            </div>
        </header>

        <main role="main" class="main-layout">
            <!-- Left Sidebar -->
            <aside class="sidebar" role="complementary">
                <!-- Import Button (like Compose) -->
                <button class="compose-btn" id="importBtn" aria-label="Import Excel file">
                    <span class="compose-icon" aria-hidden="true">ğŸ“</span>
                    <span>Import</span>
                    <input 
                        type="file" 
                        id="fileInput" 
                        accept=".xlsx,.xls"
                        aria-label="Choose Excel file to upload"
                        style="display: none;" />
                </button>

                <div id="uploadStatus" class="status-message" role="status" aria-live="polite"></div>

                <!-- Navigation Items (like Gmail labels) -->
                <nav class="sidebar-nav" aria-label="Filter navigation">
                    <button class="nav-item active" data-filter="all" aria-pressed="true">
                        <span class="nav-icon" aria-hidden="true">ğŸ“Š</span>
                        <span class="nav-label">All Members</span>
                        <span class="nav-count" id="count-all">0</span>
                    </button>
                    
                    <button class="nav-item" data-filter="active" aria-pressed="false">
                        <span class="nav-icon" aria-hidden="true">ğŸŸ¢</span>
                        <span class="nav-label">Active</span>
                        <span class="nav-count" id="count-active">0</span>
                    </button>
                    
                    <button class="nav-item" data-filter="expiring_soon" aria-pressed="false">
                        <span class="nav-icon" aria-hidden="true">â°</span>
                        <span class="nav-label">Expiring Soon</span>
                        <span class="nav-count" id="count-expiring">0</span>
                    </button>
                    
                    <button class="nav-item" data-filter="lapsed" aria-pressed="false">
                        <span class="nav-icon" aria-hidden="true">ğŸ”´</span>
                        <span class="nav-label">Lapsed</span>
                        <span class="nav-count" id="count-lapsed">0</span>
                    </button>
                    
                    <button class="nav-item" data-filter="annual_fee" aria-pressed="false">
                        <span class="nav-icon" aria-hidden="true">ğŸ’°</span>
                        <span class="nav-label">Annual Fee</span>
                        <span class="nav-count" id="count-annual">0</span>
                    </button>
                </nav>

                <!-- Campaigns Section (like Labels) -->
                <div class="sidebar-section" style="display: none;">
                    <h3 class="section-heading">Campaigns</h3>
                    <div id="campaignsList" class="campaigns-nav">
                        <!-- Campaigns will be dynamically added here -->
                    </div>
                </div>
            </aside>

            <!-- Main Content Area -->
            <div class="main-content">
                <!-- Data Table Section -->
                <section class="table-section" aria-labelledby="table-heading">
                    <div class="table-container">
                        <table id="membersTable" role="table" aria-label="Membership data">
                            <thead>
                                <tr>
                                    <th class="status-icon-header"></th>
                                    <th data-sort="playerName" tabindex="0" role="columnheader" aria-sort="none">
                                        Player Name <span class="sort-icon" aria-hidden="true">â†•</span>
                                    </th>
                                    <th data-sort="ticketDetails" tabindex="0" role="columnheader" aria-sort="none">
                                        Ticket Details <span class="sort-icon" aria-hidden="true">â†•</span>
                                    </th>
                                    <th data-sort="lastPaymentDate" tabindex="0" role="columnheader" aria-sort="none">
                                        Last Payment Date <span class="sort-icon" aria-hidden="true">â†•</span>
                                    </th>
                                    <th data-sort="lastPaymentAmount" tabindex="0" role="columnheader" aria-sort="none">
                                        Last Payment Amount <span class="sort-icon" aria-hidden="true">â†•</span>
                                    </th>
                                    <th data-sort="expiryDate" tabindex="0" role="columnheader" aria-sort="none">
                                        Expiry Date <span class="sort-icon" aria-hidden="true">â†•</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="membersTableBody">
                                <tr class="empty-state">
                                    <td colspan="6">Upload an Excel file to view membership data</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>

            <!-- Payment History Modal -->
            <div id="paymentHistoryModal" class="modal" role="dialog" aria-labelledby="modal-title" aria-modal="true" aria-hidden="true">
                <div class="modal-content">
                    <button class="close" aria-label="Close payment history dialog">&times;</button>
                    <h2 id="modal-title">Payment History</h2>
                    <div id="paymentHistoryContent"></div>
                </div>
            </div>

            <!-- Notifications Drawer -->
            <div id="notificationsDrawer" class="notifications-drawer" role="complementary" aria-label="Notifications">
                <div class="drawer-header">
                    <h3>Import Notifications</h3>
                    <button class="close-drawer" aria-label="Close notifications">&times;</button>
                </div>
                <div class="drawer-content" id="notificationsContent">
                    <p class="no-notifications">No notifications</p>
                </div>
            </div>
            <div id="drawerOverlay" class="drawer-overlay"></div>
        </main>

        <footer role="contentinfo">
            <p>Cricket Academy Membership Manager - Browser-based membership tracking</p>
        </footer>
    </div>

    <script src="src/app.js"></script>
    <script src="src/sidebar-handler.js"></script>
    <script>
        // Override setupEventListeners to include sidebar handlers
        const originalSetupEventListeners = setupEventListeners;
        setupEventListeners = function() {
            originalSetupEventListeners();
            setupSidebarEventListeners();
        };
        
        // Override updateFilterCounts to use sidebar counts
        const originalUpdateFilterCounts = updateFilterCounts;
        updateFilterCounts = function() {
            originalUpdateFilterCounts();
            updateSidebarCounts();
        };
        
        // Override renderCampaignFilter to use sidebar campaigns
        const originalRenderCampaignFilter = renderCampaignFilter;
        renderCampaignFilter = function() {
            renderSidebarCampaigns();
        };
        
        // Override handleFilterChange to update sidebar
        const originalHandleFilterChange = handleFilterChange;
        handleFilterChange = function(filter) {
            originalHandleFilterChange(filter);
            updateSidebarActiveState(filter);
            
            // Clear campaign filter when changing status filter
            if (appState.currentCampaignFilter !== 'all') {
                appState.currentCampaignFilter = 'all';
                renderSidebarCampaigns();
            }
        };
    </script>
</body>
</html>
